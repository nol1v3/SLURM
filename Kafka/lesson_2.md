# В чем отличие Kafka от сервисов очередей?

Как и сервисы очередей, Kafka условно состоит из трех базовых компонентов: сервера (брокера), продюсера и консьюмера. Главное отличие Kafka от сервисов очередей (например RabbitMQ или Amazon SQS) заключается в том, как сообщения хранятся на брокере, а также потребляются консьюмерами:

- сообщения в Kafka не удаляются по мере их обработки консьюмерами;
- одни и те же сообщения могут быть обработаны сколько угодно раз, в том числе несколькими сервисами одновременно.

# Внутренняя структура данных Kafka состоит из:

- Event (сообщение), который включает в себя: ключ (key), значение (value), timestamp и опциональный набор метаданных (headers);
- Topics (топики), в которых организованы и хранятся сообщения. В свою очередь, каждый Topic состоит из одной или более партиций;
- Partitions (партиции) - это распределенный отказоустойчивый лог (Log). Сообщения с одинаковыми ключами записываются в одну и ту же партицию;
- У каждой партиции есть один брокер лидер - Leader (принимает сообщения от Producer и в общем случае отдает сообщения консьюмеру); 
- Фолловеры (Follower) являются брокерами, которые хранят реплику всех данных партиции и осуществляют запросы лидеру.

![alt text](https://github.com/nol1v3/SLURM/blob/main/Kafka/1.png)

# Consumer Groups:

- партиции внутри одной группы назначаются консьюмерам уникально;
- партиции — это основной инструмент масштабирования;
- если консьюмеры не справляются с объемом данных, то необходимо добавить новые партиции в топик и консьюмеров в группу;
- важно помнить о гарантии очередности данных, а также то, что партиции невозможно удалить после их создания - придется удалять весь топик целиком.

![alt text](https://github.com/nol1v3/SLURM/blob/main/Kafka/2.png)

# Что такое Apache Zookeeper?

Zookeeper - один из важных компонентов кластера Kafka, который выполняет роль консистентного хранилища метаданных. В настоящее время Zookeeper является критической зависимостью для Kafka, поскольку именно он способен сказать, живы ли брокеры, какой из брокеров является контроллером, а также в каком состоянии находятся лидеры партиций и их реплики.
Важно помнить, что падение Zookeeper равнозначно падению всего кластера Kafka! Поэтому эта система также нуждается в поддержке и обновлении. Но, к счастью, нагрузка на Zookeeper при нормальной работе кластера является минимальной.
